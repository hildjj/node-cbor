<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Home - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="CborMap.html">CborMap</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CborMap.html#delete">delete</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CborMap.html#encodeCBOR">encodeCBOR</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CborMap.html#entries">entries</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CborMap.html#forEach">forEach</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CborMap.html#get">get</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CborMap.html#has">has</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CborMap.html#keys">keys</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CborMap.html#set">set</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Commented.html">Commented</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Commented.html#.comment">comment</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Decoder.html">Decoder</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Decoder.html#.decodeAll">decodeAll</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Decoder.html#.decodeAllSync">decodeAllSync</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Decoder.html#.decodeFirst">decodeFirst</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Decoder.html#.decodeFirstSync">decodeFirstSync</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Decoder.html#.nullcheck">nullcheck</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Decoder.html#close">close</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Diagnose.html">Diagnose</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Diagnose.html#.diagnose">diagnose</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Encoder.html">Encoder</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Encoder.html#.encode">encode</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Encoder.html#.encodeAsync">encodeAsync</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Encoder.html#.encodeCanonical">encodeCanonical</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Encoder.html#.encodeIndefinite">encodeIndefinite</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Encoder.html#.encodeOne">encodeOne</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Encoder.html#.removeLoopDetectors">removeLoopDetectors</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Encoder.html#addSemanticType">addSemanticType</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Encoder.html#pushAny">pushAny</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Encoder.html#removeLoopDetectors">removeLoopDetectors</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Simple.html">Simple</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Simple.html#.decode">decode</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Simple.html#.isSimple">isSimple</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Simple.html#encodeCBOR">encodeCBOR</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Simple.html#inspect">inspect</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Simple.html#toString">toString</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Tagged.html">Tagged</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Tagged.html#convert">convert</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Tagged.html#encodeCBOR">encodeCBOR</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Tagged.html#toString">toString</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#base64url">base64url</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#comment">comment</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#decode">decode</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#decodeAll">decodeAll</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#decodeAllSync">decodeAllSync</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#decodeFirst">decodeFirst</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#decodeFirstSync">decodeFirstSync</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#diagnose">diagnose</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#encode">encode</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#encodeAsync">encodeAsync</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#encodeCanonical">encodeCanonical</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#encodeOne">encodeOne</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#hasBigInt">hasBigInt</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#leveldb">leveldb</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#parseDateType">parseDateType</a></span></li>
</nav>

<div id="main">
    

    



    









    


    <section class="readme">
        <article><h1>cbor</h1>
<p>Encode and parse data in the Concise Binary Object Representation (CBOR) data format (<a href="http://tools.ietf.org/html/rfc7049">RFC7049</a>).</p>
<h2>Supported Node.js versions</h2>
<p>This project now only supports versions of Node that the Node team is <a href="https://github.com/nodejs/Release#release-schedule">currently supporting</a>.  Ava's <a href="https://github.com/avajs/ava/blob/master/docs/support-statement.md">support statement</a> is what we will be using as well.  Currently, that means Node <code>10</code>+ is required.  If you need to support an older version of Node (back to version 6), use cbor version 5.2.x, which will get nothing but security updates from here on out.</p>
<h2>Installation:</h2>
<pre class="prettyprint source lang-bash"><code>$ npm install --save cbor
</code></pre>
<p><strong>NOTE</strong>
This package now requires node.js 8.3 or higher.  It will work on node.js 6, in
a less-tested, less-featureful way.  Please start upgrading if it is possible
for you.</p>
<h2>Documentation:</h2>
<p>See the full API <a href="http://hildjj.github.io/node-cbor/">documentation</a>.</p>
<p>For a command-line interface, see <a href="https://github.com/hildjj/node-cbor/tree/master/cli">cbor-cli</a>.</p>
<p>Example:</p>
<pre class="prettyprint source lang-javascript"><code>var cbor = require('cbor');
var assert = require('assert');

var encoded = cbor.encode(true); // returns &lt;Buffer f5>
cbor.decodeFirst(encoded, function(error, obj) {
  // error != null if there was an error
  // obj is the unpacked object
  assert.ok(obj === true);
});

// Use integers as keys?
var m = new Map();
m.set(1, 2);
encoded = cbor.encode(m); // &lt;Buffer a1 01 02>
</code></pre>
<p>Allows streaming as well:</p>
<pre class="prettyprint source lang-javascript"><code>var cbor = require('cbor');
var fs = require('fs');

var d = new cbor.Decoder();
d.on('data', function(obj){
  console.log(obj);
});

var s = fs.createReadStream('foo');
s.pipe(d);

var d2 = new cbor.Decoder({input: '00', encoding: 'hex'});
d.on('data', function(obj){
  console.log(obj);
});
</code></pre>
<p>There is also support for synchronous decodes:</p>
<pre class="prettyprint source lang-javascript"><code>try {
  console.log(cbor.decodeFirstSync('02')); // 2
  console.log(cbor.decodeAllSync('0202')); // [2, 2]
} catch (e) {
  // throws on invalid input
}
</code></pre>
<p>The sync encoding and decoding are exported as a
<a href="https://github.com/Level/levelup#custom_encodings">leveldb encoding</a>, as
<code>cbor.leveldb</code>.</p>
<h2>highWaterMark</h2>
<p>The synchronous routines for encoding and decoding will have problems with
objects that are larger than 16kB, which the default buffer size for Node
streams.  There are a few ways to fix this:</p>
<ol>
<li>pass in a <code>highWaterMark</code> option with the value of the largest buffer size you think you will need:</li>
</ol>
<pre class="prettyprint source lang-javascript"><code>cbor.encodeOne(Buffer.alloc(40000), {highWaterMark: 65535})
</code></pre>
<ol start="2">
<li>use stream mode.  Catch the <code>data</code>, <code>finish</code>, and <code>error</code> events.  Make sure to call <code>end()</code> when you're done.</li>
</ol>
<pre class="prettyprint source lang-javascript"><code>const enc = new cbor.Encoder()
enc.on('data', buf => /* send the data somewhere */)
enc.on('error', console.error)
enc.on('finish', () => /* tell the consumer we are finished */)

enc.end(['foo', 1, false])
</code></pre>
<ol start="3">
<li>use <code>encodeAsync()</code>, which uses the approach from approach 2 to return a memory-inefficient promise for a Buffer.</li>
</ol>
<h2>Supported types</h2>
<p>The following types are supported for encoding:</p>
<ul>
<li>boolean</li>
<li>number (including -0, NaN, and Â±Infinity)</li>
<li>string</li>
<li>Array, Set (encoded as Array)</li>
<li>Object (including null), Map</li>
<li>undefined</li>
<li>Buffer</li>
<li>Date,</li>
<li>RegExp</li>
<li>url.URL</li>
<li>BigInt (If your JS version supports them)</li>
<li><a href="https://github.com/MikeMcl/bignumber.js">bignumber</a></li>
</ul>
<p>Decoding supports the above types, including the following CBOR tag numbers:</p>
<table>
<thead>
<tr>
<th>Tag</th>
<th>Generated Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Date</td>
</tr>
<tr>
<td>1</td>
<td>Date</td>
</tr>
<tr>
<td>2</td>
<td>bignumber</td>
</tr>
<tr>
<td>3</td>
<td>bignumber</td>
</tr>
<tr>
<td>4</td>
<td>bignumber</td>
</tr>
<tr>
<td>5</td>
<td>bignumber</td>
</tr>
<tr>
<td>32</td>
<td>url.URL</td>
</tr>
<tr>
<td>35</td>
<td>RegExp</td>
</tr>
</tbody>
</table>
<h2>Adding new Encoders</h2>
<p>There are several ways to add a new encoder:</p>
<h3><code>encodeCBOR</code> method</h3>
<p>This is the easiest approach, if you can modify the class being encoded.  Add an
<code>encodeCBOR</code> method to your class, which takes a single parameter of the encoder
currently being used.  Your method should return <code>true</code> on success, else <code>false</code>.
Your method may call <code>encoder.push(buffer)</code> or <code>encoder.pushAny(any)</code> as needed.</p>
<p>For example:</p>
<pre class="prettyprint source lang-javascript"><code>class Foo {
  constructor () {
    this.one = 1
    this.two = 2
  }
  encodeCBOR (encoder) {
    const tagged = new Tagged(64000, [this.one, this.two])
    return encoder.pushAny(tagged)
  }
}
</code></pre>
<p>You can also modify an existing type by monkey-patching an <code>encodeCBOR</code> function
onto its prototype, but this isn't recommended.</p>
<h3><code>addSemanticType</code></h3>
<p>Sometimes, you want to support an existing type without modification to that
type.  In this case, call <code>addSemanticType(type, encodeFunction)</code> on an existing
<code>Encoder</code> instance. The <code>encodeFunction</code> takes an encoder and an object to
encode, for example:</p>
<pre class="prettyprint source lang-javascript"><code>class Bar {
  constructor () {
    this.three = 3
  }
}
const enc = new Encoder()
enc.addSemanticType(Bar, (encoder, b) => {
  encoder.pushAny(b.three)
})
</code></pre>
<h2>Adding new decoders</h2>
<p>Most of the time, you will want to add support for decoding a new tag type.  If
the Decoder class encounters a tag it doesn't support, it will generate a <code>Tagged</code>
instance that you can handle or ignore as needed.  To have a specific type
generated instead, pass a <code>tags</code> option to the <code>Decoder</code>'s constructor, consisting
of an object with tag number keys and function values.  The function will be
passed the decoded value associated with the tag, and should return the decoded
value.  For the <code>Foo</code> example above, this might look like:</p>
<pre class="prettyprint source lang-javascript"><code>const d = new Decoder({tags: { 64000: (val) => {
  // check val to make sure it's an Array as expected, etc.
  const foo = new Foo()
  foo.one = val[0]
  foo.two = val[1]
  return foo
}}})
</code></pre>
<h2>Developers</h2>
<p>The tests for this package use a set of test vectors from RFC 7049 appendix A by importing a machine readable version of them from https://github.com/cbor/test-vectors. For these tests to work, you will need to use the command <code>git submodule update --init</code> after cloning or pulling this code.   See https://gist.github.com/gitaarik/8735255#file-git_submodules-md for more information.</p>
<p>Get a list of build steps with <code>npm run</code>.  I use <code>npm run dev</code>, which rebuilds,
runs tests, and refreshes a browser window with coverage metrics every time I
save a <code>.js</code> file.  If you don't want to run the fuzz tests every time, set
a <code>NO_GARBAGE</code> environment variable:</p>
<pre class="prettyprint source"><code>env NO_GARBAGE=1 npm run dev
</code></pre>
<p><a href="https://github.com/hildjj/node-cbor/actions?query=workflow%3ATests"><img src="https://github.com/hildjj/node-cbor/workflows/Tests/badge.svg" alt="Build Status"></a>
<a href="https://coveralls.io/r/hildjj/node-cbor?branch=master"><img src="https://coveralls.io/repos/hildjj/node-cbor/badge.svg?branch=master" alt="Coverage Status"></a>
<a href="https://david-dm.org/hildjj/node-cbor"><img src="https://david-dm.org/hildjj/node-cbor.svg" alt="Dependency Status"></a></p></article>
    </section>






</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.6</a> using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>